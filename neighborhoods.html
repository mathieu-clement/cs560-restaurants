<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Line chart</title>
	<script src="https://d3js.org/d3.v5.min.js"></script>
	<style type="text/css">
    .label {
		font-family: Helvetica, sans-serif;
        font-size: 10px;
        text-anchor: middle;
    }
</style>
</head>
<body>
	<script type="text/javascript">
		const w = 400;
		const h = 300;

        var sanfrancisco = [-122.45, 37.79];

        var projection = d3.geoMercator()
                           .center(sanfrancisco)
                           .translate([w/2, h/2])
                           .scale([130000]);

        var path = d3.geoPath()
                     .projection(projection);

        var formatDecimals = d3.format(".3");

		var svg = d3
		.select("body")
		.append("svg")
		.attr("width", w + 100)
		.attr("height", h + 100)
        ;

        /*
		svg.append("text")
		.attr("x", w/2)
		.attr("y", -30)
		.attr("dy", ".35em")
		.attr("font-size", 18)
		.attr("font-weight", "bold")
		.attr("fill", "black")
		.style("text-anchor", "middle")
		.text("Health score over time");
        */

        d3.json("neighborhoods.json").then(function(json) {
            svg
                .selectAll("path")
                .data(json.features)
                .enter()
                .append("path")
                .attr("d", path)
                .style("fill", "steelblue")
                ; 

            d3.json("neighborhood_average_scores.json").then(function(data) {
                for (var i in json.features) {
                    var feature = json.features[i];
                    var nhood = feature.properties['nhood'];
                    feature.properties.average = data[nhood];
                }

                svg
                    .selectAll("text")
                    .data(json.features)
                    .enter()
                    .append("text")
                    .attr("class", "label")
                    .attr("x", function(d) { return path.centroid(d)[0]; })
                    .attr("y", function(d) { return path.centroid(d)[1]; })
                    .text(function(d) {
                        return formatDecimals(d.properties.average);
                    })
                    ;

            }); // d3.json avg scores
        }); // d3.json neighborhoods geoson
        
	</script>
</body>
</html>
